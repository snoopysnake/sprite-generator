<!DOCTYPE html>
<!--
To change this license header, choose License Headers in Project Properties.
To change this template file, choose Tools | Templates
and open the template in the editor.
-->
<html>
    <head>
        <title>Sprite Generator</title>
        <meta charset="UTF-8">
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        <script>
            var layer_selected;
            var layers_menu;
            var buttons_menu;
            function setup() {
                //Set up global vars
                layers_menu = document.getElementById('generator-layers');
                buttons_menu = document.getElementById('generator-div-4');
                //Set up layer button colors
                var layer_btns = document.getElementsByClassName('layer-btn');
                for (var i = 0; i < layer_btns.length; i++) {
                    layer_btns[i].style.backgroundColor = 'rgb(' + Math.floor(255 - 10 * i) + ', ' +
                        Math.floor(255 - 10 * i) + ', 0)';
                    layer_btns[i].onclick = function(){
                        choose_layer(this);
                    }
                }
                //Set up canvas background
                var background = document.getElementById('background-layer');
                var ctx = background.getContext('2d');
                for (var i = 0; i < 32; i++) {
                  for (var j = 0; j < 32; j++) {
                    ctx.fillStyle = 'rgb(' + Math.floor(255 - 10 * i) + ', ' +
                        Math.floor(255 - 10 * j) + ', 0)';
                    ctx.fillRect(j * 25, i * 25, 25, 25);
                  }
                }
            }
            function choose_layer(button) {
                layer_selected = button.value.toLowerCase();
                buttons_menu.style.display = 'flex';
                buttons_menu.style.backgroundColor = button.style.backgroundColor;
            }
            function draw() {
                var layer = document.getElementById(layer_selected+'-layer');
                var ctx = layer.getContext('2d');
                //Why isn't this updating? Stupid host
                ctx.clearRect(0, 0, 32, 32);
                var img = new Image();
                img.onload = function() {
                    ctx.drawImage(img, 0, 0);
                }
                img.src = layer_selected+'-1.png'
            }
            function erase() {
                var layer = document.getElementById(layer_selected+'-layer');
                var ctx = layer.getContext('2d');
                ctx.clearRect(0, 0, 32, 32);
            }
            function erase_all() {
                var layers = document.getElementsByClassName('layer');
                for(var i = 1; i < layers.length; i++)
                {
                    var ctx = layers[i].getContext('2d');
                    ctx.clearRect(0, 0, 32, 32);
                }
            }
            function export_img() {
                var layers = document.getElementsByClassName('layer');
                var export_layer = document.getElementById('export-layer');
                var ctx = export_layer.getContext('2d');
                ctx.webkitImageSmoothingEnabled = false;
                ctx.mozImageSmoothingEnabled = false;
                ctx.imageSmoothingEnabled = false;
                ctx.save();
                ctx.drawImage(layers[0],0,0); //Background does not need rescale
                ctx.scale(16,16);
                for(var i = 1; i < layers.length; i++)
                {
                    ctx.drawImage(layers[i],0,0);
                }
                //Export dialog needs work
                var exported_img = export_layer.toDataURL("image/png").replace("image/png", "image/octet-stream"); //Convert image to 'octet-stream' (Just a download, really)
                window.location.href = exported_img;
                ctx.clearRect(0, 0, 512, 512);
                ctx.restore();
            }
        </script>
    <style type="text/css">
        canvas { 
            /*border: 1px solid black;*/
            position: absolute;
            image-rendering: optimizeSpeed;
            image-rendering: -moz-crisp-edges;
            image-rendering: -webkit-optimize-contrast;
            image-rendering: optimize-contrast;
            image-rendering: pixelated;
            -ms-interpolation-mode: nearest-neighbor;
            width: 512px; 
            height: 512px;  
        }
        #container {
            display: inline-flex;
            border: 4px solid black;

        }
        #header-div {
            background-color: white;
            width: 832px;
            height: 32px;
        }
        #tool-div {
            width: 64px;
            display: inline-block;
            text-align: center;
            float: right;
        }
        #edit-div {
            width: 256px;
            display: inline-block;
            text-align: center;
            float: right;
        }
        #generator-div-1 {
            height: 512px;
            width: 64px;
            /*float:left;*/
        } 
        #generator-div-2 {
            width: 512px; 
            height: 512px;
            /*float:left;*/
        }
        #generator-tools input {
            border: none;
            background-color: red;
            height: 56px;
            width: 56px;
            white-space: normal;
            border-radius: 50%;
            margin: 4px;
            outline-style: none;
        }
        #generator-div-3 {
            /*border: 1px solid black;*/
            width: 128px; 
            height: 512px;
            /*display: inline-flex;*/
            /*float:left;
        }
        #generator-layers {
            /*display: block;*/
        }
        #generator-layers input {
            border: none;
            height: 32px;
            border-radius: 8px;
            width: 128px;
        }
        #generator-div-4 {
            background-color: red;
            width: 256px; 
            height: 512px;
            display: none;
            flex-direction: column;
        }
        #generator-btns { 
            height: 448px; 
        }
        #generator-btns.row {
            display: flex;
            flex-direction: row;

        }
        #generator-btns div {
            height: 64px;
            width: 64px;
            background-color: blue;
            display: flex;
            flex-flow: column wrap;
        }
        #generator-btns input {
            border: none;
            background-color: red;
            height: 64px;
            width: 64px;
            margin: 4px;

            /*float: left;*/
        }
        #generator-btns-bottom {
            height: 64px;
            width: 256px;
            display: flex;
            align-items: center;
            text-align: center;
        }
        #forward-btn {
            flex: 1;
        }
        #page {
            flex: 3;
        }
        #back-btn {
            flex: 1;
        } 
        #background-layer { z-index: 1 }
        #face-layer { z-index: 2 }
        #hair-layer { z-index: 3 }
        #accessories-layer { z-index: 4 }
    </style>
    </head>
    <body onload='setup()'>
        <div id='container'>
<!--             <div id='header-div'>
                <div id='edit-div'>Edit Features</div>
                <div id='tool-div'>Tools</div>
            </div> -->
            <div id='generator-div-1'>
                <div id='generator-tools'>
                    <input type='button' value='Change Color'>
                    <input type='button' value='Erase Layer' onclick='erase()'>
                    <input type='button' value='Erase All' onclick='erase_all()'>
                    <input id='export-btn' type='button' value='Export!' onclick='export_img()'>
                </div>
            </div>
            <div id="generator-div-2">
                <canvas id="background-layer" class='layer' width="512" height="512"></canvas>
                <canvas id="face-layer" class='layer' width="32" height="32"></canvas>
                <canvas id="hair-layer" class='layer' width="32" height="32"></canvas>
                <canvas id="accessories-layer" class='layer' width="32" height="32"></canvas>
                <canvas id="export-layer" width="512" height="512"></canvas>
            </div>
            <div id='generator-div-3'>
                <div id='generator-layers'>
                    <input type='button' value='Face' class='layer-btn'>
                    <input type='button' value='Hair' class='layer-btn'>
                    <input type='button' value='Accessories' class='layer-btn'>
                    <input type='button' value='Eyes'>
                    <input type='button' value='Nose'>
                    <input type='button' value='Mouth'>
                    <!--<input type='button' value='Background' onclick='choose_layer(this)'>-->
                </div>
            </div>
            <div id='generator-div-4'>
                <div id='generator-options'>
                    <!-- dynamically load buttons -->
                    <div id='generator-btns'>
                        <div class='row'>
                            <div></div><div></div><div></div><div></div>
                        </div>
                        <div class='row'>
                            <div></div><div></div><div></div><div></div>
                        </div>
                        <div class='row'>
                            <div></div><div></div><div></div><div></div>
                        </div>
                        <div class='row'>
                            <div></div><div></div><div></div><div></div>
                        </div>
                        <div class='row'>
                            <div></div><div></div><div></div><div></div>
                        </div>
                        <div class='row'>
                            <div></div><div></div><div></div><div></div>
                        </div>
                        <div class='row'>
                            <div></div><div></div><div></div><div></div>
                        </div>
                    </div>
                </div>
                <div id='generator-btns-bottom'>
                    <div id='forward-btn'>
                        <input  type='button' value='<-'/>
                    </div>
                    <a id='page'>Page 1</a>
                    <div id='back-btn'>
                        <input type='button' value='->'/>
                    </div>
                </div>
            </div>
        </div>
    </body>
</html>
